#!/usr/bin/env bash

PACK_DIR=`cd $(dirname $0)/..; pwd`
HOME=$1

# TODO: run for all files in .profile.d?
chmod +x .profile.d/ruby.sh
. .profile.d/ruby.sh
export RACK_ENV=test

echo "gem 'builder'" >> Gemfile

# Why isn't --no-deployment not working?
rm -rf .bundle/config
bundle install --without nothing --path vendor/bundle

bundle exec rspec -r "$PACK_DIR/opt/rspec/junit_formatter.rb" -f JUnit -o results.xml

echo "done"
